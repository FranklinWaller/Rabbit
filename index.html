<!DOCTYPE html>
<html>
    <head>
        <title>Boilerplayer</title>
        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    </head>
    <body>
        <h1>Rutile testing environment</h1>
        <section>
            <div>
                <label>Private Key:</label>
                <input type="text" id="privateKey" value="C0DEC0DEC0DEC0DEC0DEC0DEC0DEC0DEC0DEC0DEC0DEC0DEC0DEC0DEC0DEC0DE" />
            </div>
            <div>
                <label>Address:</label>
                <span id="address">0x0000000000000000000000000000</span>
            </div>
            <div>
                Is Rutile active? <span id="isRutileActive">No</span>
            </div>
            <button onclick="setPrivateKey()">Set private key</button>
        </section>

        <h2>RUT sending</h2>
        <section>
            <div>
                <label>Address</label>
                <input type="text" id="valueAddressTo" />
            </div>
            <div>
                <label>Value</label>
                <input type="number" id="valueAddress" />RUT
            </div>
            <button onclick="sendValue()">Send transaction</button>
        </section>
        <h2>Upload file to local IPFS Node</h2>
        <section>
            <div>
                <label>File</label>
                <input type="file" id="valueFile" />
            </div>
        </section>
        <h2>Read file from local IPFS Node</h2>
        <section>
            <div>
                <label>Hash of file</label>
                <input type="text" id="valueHash"/>
            </div>
            <button onclick="getIpfsFile()">Get file</button>
        </section>

        <div id="app"></div>
        <script src="build/rutile.js" charset="utf-8"></script>
        <script>
            let rutile = null;
            let keyPair = null;
            setPrivateKey();

            async function run() {
                try {
                    rutile = new Rutile();
                    await rutile.start();

                    document.getElementById('isRutileActive').innerHTML = 'Yes';
                } catch (error) {
                    console.error(error);
                    document.getElementById('isRutileActive').innerHTML = 'Error';
                }
            }

            async function setPrivateKey() {
                keyPair = new Rutile.KeyPair(document.getElementById('privateKey').value);
                document.getElementById('address').innerHTML = keyPair.getAddress();
            }

            async function sendValue() {
                const privateKey = document.getElementById('privateKey').value;
                const toAddress = document.getElementById('valueAddressTo').value;
                const value = document.getElementById('valueAddress').value;

                const keyPair = new Rutile.KeyPair(privateKey);
                const account = await Rutile.Account.getFromAddress(keyPair.getAddress());
                const transaction = new Rutile.Transaction({
                    to: toAddress,
                    value,
                    data: [],
                });

                transaction.sign(keyPair);

                console.log(rutile);
            }

            async function uploadFileToLocalIPFS(evt) {
                var f = evt.target.files[0]; 

                if (f) {
                var r = new FileReader();
                r.onload = async function(e) { 
                    var content = e.target.result;
                    var hash = await rutile.Ipfs.add(content);
                    console.log('IPFS HASH / ADDRESS: ' + hash);
                }
                r.readAsText(f);
                } else { 
                    alert("Failed to load file");
                }
            }

            async function getIpfsFile(){
                const value = document.getElementById('valueHash').value;
                var content = await rutile.Ipfs.cat(value);
                console.log('Value of ' + value + ': \n' + content);
            }
            document.getElementById('valueFile').addEventListener('change', uploadFileToLocalIPFS, false);
            run();

        </script>
        <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet">
    </body>
</html>
